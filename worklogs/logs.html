<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Work Logs</title>
<style>
    body {
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 30px;
    }
    .year-box {
        background: #222;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
        border: 2px solid #00ff00;
    }
    .year-title {
        font-size: 28px;
        margin-bottom: 15px;
        color: #00ff00;
    }
    .month-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    button {
        background: #00ff00;
        color: black;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: bold;
    }
    button:hover {
        background: #55ff55;
    }
    #results {
        margin-top: 40px;
        padding: 20px;
        background: #222;
        border-radius: 12px;
        border: 2px solid #00ff00;
    }
    .entry {
        background: #333;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }
    .total-box {
        background: #000;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border: 2px solid #00ff00;
        font-size: 20px;
        font-weight: bold;
    }
</style>
</head>
<body>

<h1>Work Logs</h1>

<!-- YEAR 2025 -->
<div class="year-box">
    <div class="year-title">2025</div>
    <div class="month-buttons">
        <button onclick="loadMonth(2025, 1)">January</button>
        <button onclick="loadMonth(2025, 2)">February</button>
        <button onclick="loadMonth(2025, 3)">March</button>
        <button onclick="loadMonth(2025, 4)">April</button>
        <button onclick="loadMonth(2025, 5)">May</button>
        <button onclick="loadMonth(2025, 6)">June</button>
        <button onclick="loadMonth(2025, 7)">July</button>
        <button onclick="loadMonth(2025, 8)">August</button>
        <button onclick="loadMonth(2025, 9)">September</button>
        <button onclick="loadMonth(2025, 10)">October</button>
        <button onclick="loadMonth(2025, 11)">November</button>
        <button onclick="loadMonth(2025, 12)">December</button>
    </div>
</div>

<!-- YEAR 2026 -->
<div class="year-box">
    <div class="year-title">2026</div>
    <div class="month-buttons">
        <button onclick="loadMonth(2026, 1)">January</button>
        <button onclick="loadMonth(2026, 2)">February</button>
        <button onclick="loadMonth(2026, 3)">March</button>
        <button onclick="loadMonth(2026, 4)">April</button>
        <button onclick="loadMonth(2026, 5)">May</button>
        <button onclick="loadMonth(2026, 6)">June</button>
        <button onclick="loadMonth(2026, 7)">July</button>
        <button onclick="loadMonth(2026, 8)">August</button>
        <button onclick="loadMonth(2026, 9)">September</button>
        <button onclick="loadMonth(2026, 10)">October</button>
        <button onclick="loadMonth(2026, 11)">November</button>
        <button onclick="loadMonth(2026, 12)">December</button>
    </div>
</div>

<div id="results"></div>

<script>
const BASE_URL = "https://pub-c81b38df15744babba70c092dbab8a1c.r2.dev";

async function loadMonth(year, month) {
    const resultsDiv = document.getElementById("results");
    const monthStr = String(month).padStart(2, "0");
    const folder = `${BASE_URL}/worklogs/${year}/${monthStr}/`;

    resultsDiv.innerHTML = `<h2>Loading ${year} / ${monthStr}...</h2>`;

    let totalMinutes = 0;
    let html = `<h2>${year} â€“ ${monthStr}</h2>`;

    try {
        console.log("Fetching index.json:", folder + "index.json");
        const fileList = await fetch(folder + "index.json").then(r => r.json());
        console.log("index.json contents:", fileList);

        for (const file of fileList) {
            console.log("Fetching entry:", folder + file);
            const log = await fetch(folder + file).then(r => r.json());
            console.log("Entry contents:", log);

            html += `
                <div class="entry">
                    <strong>Date:</strong> ${log.date}<br>
                    <strong>Time In:</strong> ${log.timeIn}<br>
                    <strong>Time Out:</strong> ${log.timeOut}<br>
                    <strong>Duration:</strong> ${log.duration}<br>
                    <strong>Notes:</strong> ${log.notes}
                </div>
            `;

            // Safe duration parsing
            const match = log.duration.match(/(\d+)h\s+(\d+)m/);
            if (match) {
                totalMinutes += parseInt(match[1]) * 60 + parseInt(match[2]);
            } else {
                console.warn("Duration did not match expected format:", log.duration);
            }
        }

        const totalHours = Math.floor(totalMinutes / 60);
        const totalMins = totalMinutes % 60;

        html += `
            <div class="total-box">
                Total Hours: ${totalHours}h ${totalMins}m
            </div>
        `;

        resultsDiv.innerHTML = html;

    } catch (err) {
        console.error("ERROR LOADING LOGS:", err);
        resultsDiv.innerHTML = `<h2>No logs found for ${year}/${monthStr}</h2>`;
    }
}
</script>

</body>
</html>

